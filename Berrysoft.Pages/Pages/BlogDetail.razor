@page "/blog/{filename}"

@using Berrysoft.Pages.Data

@implements IDisposable

@inject LocalizationService Localization
@inject BlogService BlogService

@if (notFound)
{
    <NotFoundComponent />
}
else if (text != null && post != null)
{
    <div class="fade-in fade-in-1">
        <h1>@post.Title</h1>
        <p class="text-secondary">
            <time datetime="@post.Date">@post.Date.ToString(Localization.Culture.DateTimeFormat.FullDateTimePattern, Localization.Culture)</time>
        </p>
    </div>
    <div class="fade-in fade-in-2">
        @((MarkupString)text)
    </div>
}

@code {
    [Parameter]
    public string? Filename { get; set; }

    private BlogPost? post;
    private string? text;
    private bool notFound;

    protected override async Task OnInitializedAsync()
    {
        Localization.LanguageChanged += OnLanguageChanged;
        (post, text) = await BlogService.GetBlogPostAsync(Filename!);
        notFound = post == null;
    }

    private void OnLanguageChanged(object sender, string e)
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        Localization.LanguageChanged -= OnLanguageChanged;
    }
}
