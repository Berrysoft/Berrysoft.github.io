@page "/blog/{filename}"

@using Berrysoft.Pages.Data
@using Markdig

@inject IBlogService BlogService

@if (text == null)
{
    @if (notFound)
    {
        <NotFoundComponent />
    }
}
else
{
    @((MarkupString)text)
}

@code {
    [Parameter]
    public string Filename { get; set; }

    private string text;
    private bool notFound;

    private static readonly MarkdownPipeline markdigPipeline = new MarkdownPipelineBuilder().UseAdvancedExtensions().Build();

    protected override async Task OnInitializedAsync()
    {
        await Task.Run(async () =>
        {
            string content = await BlogService.GetBlogPostContent(Filename);
            if (content == null)
            {
                text = null;
                notFound = true;
            }
            else
            {
                text = Markdown.ToHtml(content, markdigPipeline);
                notFound = false;
            }
        });
    }
}
